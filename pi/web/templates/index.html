<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VPN Control Panel</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <div class="page">
      <header class="hero">
        <div>
          <p class="eyebrow">Cloud VPN Gateway</p>
          <h1>VPN Control Panel</h1>
          <p class="subtitle">
            Enable or disable your VPN tunnel and switch between any installed
            endpoints.
          </p>
        </div>
      </header>

      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <div class="flash-grid">
        {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %}

      <form method="post" action="{{ url_for('toggle_vpn') }}">
        <article class="card">
          <header class="card-header">
            <div>
              <h2>Connection</h2>
              <p class="hint">
                Swap between VPN endpoints stored at
                <code class="path">{{ status.config_archive }}</code> or route
                directly without WireGuard.
              </p>
            </div>
            <div
              class="status-chip {{ 'online' if status.status == 'active' else 'offline' }}"
            >
              <span class="dot"></span>
              {{ 'VPN Enabled' if status.status == 'active' else 'VPN Disabled' }}
            </div>
          </header>

          <div class="stack">
            {% if locations %}
            {% for key, data in locations.items() %}
            <label class="option">
              <input
                type="radio"
                name="location"
                value="{{ key }}"
                {% if status.status == 'active' and status.location == key %}checked{% endif %}
                required
              />
              <div>
                <div class="option-title">{{ data.label }}</div>
                <code class="path">{{ data.config }}</code>
              </div>
            </label>
            {% endfor %}
            {% else %}
            <p class="hint">
              No configs found. Ensure your WireGuard files (e.g.,
              <code>frankfurt.conf</code>) are placed in
              <code class="path">{{ status.config_archive }}</code> and redeploy
              or refresh.
            </p>
            {% endif %}

            <label class="option no-vpn">
              <input
                type="radio"
                name="location"
                value="none"
                {% if status.status != 'active' %}checked{% endif %}
                required
              />
              <div>
                <div class="option-title">No VPN (Direct connection)</div>
                <p class="option-desc">Send traffic without WireGuard routing.</p>
              </div>
            </label>

            <button
              class="button primary"
              type="submit"
              id="apply-button"
              name="action"
              value="apply"
            >
              Apply selection
            </button>
          </div>
        </article>
      </form>

      <footer class="footer">
        <p>
          Ensure the corresponding WireGuard configuration files exist on the Pi
          before switching locations.
        </p>
      </footer>
    </div>

    <script>
      const radioButtons = document.querySelectorAll('input[name="location"]');
      const applyButton = document.getElementById('apply-button');

      function syncButtonStyle() {
        const selected = document.querySelector('input[name="location"]:checked');
        if (!selected || !applyButton) return;

        if (selected.value === 'none') {
          applyButton.classList.add('danger');
          applyButton.classList.remove('primary');
        } else {
          applyButton.classList.add('primary');
          applyButton.classList.remove('danger');
        }
      }

      radioButtons.forEach((radio) => {
        radio.addEventListener('change', syncButtonStyle);
      });

      syncButtonStyle();
    </script>
  </body>
</html>
